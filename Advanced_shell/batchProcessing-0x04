#!/bin/bash

# Directory to store fetched JSON files
DATA_DIR="pokemon_data"
ERROR_LOG="errors.txt"

# Create or clean data and log directories
mkdir -p "$DATA_DIR"
> "$ERROR_LOG"

# List of Pokémon to fetch (lowercase for API)
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Function to fetch data with retry logic (up to 3 tries)
fetch_pokemon() {
  local pokemon=$1
  local file="$DATA_DIR/${pokemon}.json"
  local retries=3

  echo "Fetching data for $pokemon..."

  for ((i=1; i<=retries; i++)); do
    if curl -s -f "https://pokeapi.co/api/v2/pokemon/$pokemon" -o "$file"; then
      echo "Saved data to $file ✅"
      return
    else
      echo "Attempt $i failed for $pokemon"
      sleep 2
    fi
  done

  echo "❌ Failed to fetch data for $pokemon after $retries attempts." >> "$ERROR_LOG"
}

# Loop through Pokémon and run fetch_pokemon in background
for pokemon in "${POKEMONS[@]}"; do
  fetch_pokemon "$pokemon" &
done

# Wait for all background processes to finish
wait

echo ""
echo "✅ All fetch tasks completed."
